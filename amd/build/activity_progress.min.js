define(["jquery","local_activity_progress/user_progress","bc"],function(a,b){function c(a,c,d){this.playerid=a,this.updateIntervalMS=1e3/24,this.player=videojs(a),this.intervalid=null,this.userProgressAPI=new b(c,d),this.player.on("play",this.onPlay.bind(this)),this.player.on("pause",this.onPause.bind(this)),this.player.on("ended",this.onEnded.bind(this)),this.player.on("loadedmetadata",this.onLoadedmetadata.bind(this)),window.console.debug("BrightcoveProgress [new]",this)}return c.prototype.onLoadedmetadata=function(b){var c=this.player.el().dataset.progress,d=this.player.duration(),e=(d*(c/100)).toFixed(3),f=0;f=c>98?0:e,a("#"+this.playerid).removeClass("notHover vjs-paused ").addClass("vjs-has-started").each(function(){0==f&&a(".vjs-poster").show()}),a(".vjs-big-play-button").show().focus(),this.player.currentTime(f)},c.prototype.onPlay=function(){a(".vjs-big-play-button").hide(),a(".vjs-poster").hide(),window.console.debug("BrightcoveProgress.onPlay"),this.startMonitoring()},c.prototype.onPause=function(){a(".vjs-big-play-button").show(),window.console.debug("BrightcoveProgress.onPause"),this.stopMonitoring()},c.prototype.onEnded=function(){window.console.debug("BrightcoveProgress.onEnded"),this.stopMonitoring(),this.userProgressAPI.update(100),this.userProgressAPI.saveNow()},c.prototype.stopMonitoring=function(){null!==this.intervalid&&(this.player.clearInterval(this.intervalid),this.intervalid=null)},c.prototype.startMonitoring=function(){this.stopMonitoring(),this.intervalid=this.player.setInterval(this.updateProgress.bind(this),this.updateIntervalMS)},c.prototype.updateProgress=function(){var a=this.player.currentTime(),b=this.player.duration(),c=a/b*100;window.console.debug("BrightcoveProgress",a,b,c),this.userProgressAPI.update(c)},{init:function(a){window.console.debug("BrightcoveProgress [init]",a),new c(a.playerid,a.cmid,a.userid)}}});