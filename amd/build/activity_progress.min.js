define(["jquery","local_activity_progress/user_progress","bc"],function(a,b){function c(){window.console.debug("BrightcoveProgress [new]"),this.playerid=null,this.player=null,this.userProgressAPI=b,this.updateIntervalMS=1e3/24,this.intervalid=null}return c.prototype.onLoadedmetadata=function(){var b=this.player.el().dataset.progress,c=this.player.duration(),d=(c*(b/100)).toFixed(3),e=0;e=b>98?0:d,a("#"+this.playerid).removeClass("notHover vjs-paused ").addClass("vjs-has-started").each(function(){0==e&&a(".vjs-poster").show()}),a(".vjs-big-play-button").show(),a(".vjs-play-control").focus(),this.player.currentTime(e),this.startMonitoring()},c.prototype.onPlay=function(){window.console.debug("BrightcoveProgress.onPlay"),a(".vjs-big-play-button").hide(),a(".vjs-poster").hide()},c.prototype.onPause=function(){window.console.debug("BrightcoveProgress.onPause"),a(".vjs-big-play-button").show(),this.userProgressAPI.saveNow()},c.prototype.onEnded=function(){window.console.debug("BrightcoveProgress.onEnded"),this.userProgressAPI.update(100),this.userProgressAPI.saveNow()},c.prototype.stopMonitoring=function(){null!==this.intervalid&&(this.player.clearInterval(this.intervalid),this.intervalid=null)},c.prototype.startMonitoring=function(){this.stopMonitoring(),this.intervalid=this.player.setInterval(this.updateProgress.bind(this),this.updateIntervalMS)},c.prototype.updateProgress=function(){var a=this.player.currentTime(),b=this.player.duration(),c=a/b*100;window.console.debug("BrightcoveProgress",a,b,c),isNaN(c)||this.userProgressAPI.update(c)},c.prototype.init=function(a){window.console.debug("BrightcoveProgress.init",a),this.playerid=a.playerid,this.player=videojs(this.playerid),this.userProgressAPI.initialise(a.cmid,a.userid),this.player.on("play",this.onPlay.bind(this)),this.player.on("pause",this.onPause.bind(this)),this.player.on("ended",this.onEnded.bind(this)),this.player.on("loadedmetadata",this.onLoadedmetadata.bind(this))},new c});