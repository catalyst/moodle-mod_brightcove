define(["local_activity_progress/user_progress","bc"],function(a){function b(b,c,d){this.updateIntervalMS=500,this.player=videojs(b),this.intervalid=null,this.userProgressAPI=new a(c,d),this.player.on("play",this.onPlay.bind(this)),this.player.on("pause",this.onPause.bind(this)),this.player.on("ended",this.onEnded.bind(this)),this.player.on("loadedmetadata",this.onLoadedmetadata.bind(this)),window.console.debug("BrightcoveProgress [new]",this)}return b.prototype.onLoadedmetadata=function(a){var b=this.player.el().dataset.progress,c=this.player.duration(),d=(c*(b/100)).toFixed(3),e=0;e=b>98?0:d,this.player.currentTime(e)},b.prototype.onPlay=function(){window.console.debug("BrightcoveProgress.onPlay"),this.startMonitoring()},b.prototype.onPause=function(){window.console.debug("BrightcoveProgress.onPause"),this.stopMonitoring()},b.prototype.onEnded=function(){window.console.debug("BrightcoveProgress.onEnded"),this.stopMonitoring(),this.userProgressAPI.update(100),this.userProgressAPI.saveNow()},b.prototype.stopMonitoring=function(){null!==this.intervalid&&(this.player.clearInterval(this.intervalid),this.intervalid=null)},b.prototype.startMonitoring=function(){this.stopMonitoring(),this.intervalid=this.player.setInterval(this.updateProgress.bind(this),this.updateIntervalMS)},b.prototype.updateProgress=function(){var a=this.player.currentTime(),b=this.player.duration(),c=Math.round(a/b*100);window.console.debug("BrightcoveProgress",a,b,c),this.userProgressAPI.update(c)},{init:function(a){window.console.debug("BrightcoveProgress [init]",a),new b(a.playerid,a.cmid,a.userid)}}});